<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Lesson 4: Working with Multiple Tables</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../libs/clipboard/clipboard.min.js"></script>
<script src="../libs/quarto-html/quarto.js" type="module"></script>
<script src="../libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../libs/quarto-html/popper.min.js"></script>
<script src="../libs/quarto-html/tippy.umd.min.js"></script>
<script src="../libs/quarto-html/anchor.min.js"></script>
<link href="../libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../libs/bootstrap/bootstrap.min.js"></script>
<link href="../libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../libs/bootstrap/bootstrap-8de619bbd21ce238746bc3d87e490689.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<link href="../libs/quarto-contrib/interactive-sql-1.0.0/interactive-sql.css" rel="stylesheet">
<link rel="preconnect" href="https://fonts.googleapis.com">

<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="">

<link href="https://fonts.googleapis.com/css2?family=Public+Sans:ital,wght@0,100..900;1,100..900&amp;display=swap" rel="stylesheet">
<script src="https://unpkg.com/@antonz/sqlite@3.40.0/dist/sqlite3.js"></script>
<script src="https://unpkg.com/sqlime@0.1.3/dist/sqlime-db.js"></script>
<script src="https://unpkg.com/sqlime@0.1.3/dist/sqlime-examples.js"></script>


</head>

<body class="quarto-light">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#understanding-table-relationships" id="toc-understanding-table-relationships" class="nav-link" data-scroll-target="#understanding-table-relationships">Understanding table relationships</a></li>
  <li><a href="#types-of-joins-in-sql" id="toc-types-of-joins-in-sql" class="nav-link" data-scroll-target="#types-of-joins-in-sql">Types of joins in SQL</a></li>
  <li><a href="#using-table-aliases" id="toc-using-table-aliases" class="nav-link" data-scroll-target="#using-table-aliases">Using table aliases</a></li>
  <li><a href="#inner-join-matching-records-across-tables" id="toc-inner-join-matching-records-across-tables" class="nav-link" data-scroll-target="#inner-join-matching-records-across-tables">INNER JOIN: Matching records across tables</a>
  <ul class="collapse">
  <li><a href="#linking-resident-demographics-to-intakes-hh" id="toc-linking-resident-demographics-to-intakes-hh" class="nav-link" data-scroll-target="#linking-resident-demographics-to-intakes-hh">Linking resident demographics to intakes hh</a></li>
  </ul></li>
  <li><a href="#left-join-keeping-all-records-from-the-first-left-table" id="toc-left-join-keeping-all-records-from-the-first-left-table" class="nav-link" data-scroll-target="#left-join-keeping-all-records-from-the-first-left-table">LEFT JOIN: Keeping all records from the first (left) table</a>
  <ul class="collapse">
  <li><a href="#joining-intakes-with-resident-data" id="toc-joining-intakes-with-resident-data" class="nav-link" data-scroll-target="#joining-intakes-with-resident-data">Joining intakes with resident data</a></li>
  </ul></li>
  <li><a href="#right-join-keeping-all-records-from-the-second-right-table" id="toc-right-join-keeping-all-records-from-the-second-right-table" class="nav-link" data-scroll-target="#right-join-keeping-all-records-from-the-second-right-table">RIGHT JOIN: Keeping all records from the second (right) table</a>
  <ul class="collapse">
  <li><a href="#viewing-all-intakes-even-without-matching-resident-info" id="toc-viewing-all-intakes-even-without-matching-resident-info" class="nav-link" data-scroll-target="#viewing-all-intakes-even-without-matching-resident-info">Viewing all intakes (even without matching resident info)</a></li>
  </ul></li>
  <li><a href="#full-outer-join-or-full-join-keeping-all-records-from-both-tables" id="toc-full-outer-join-or-full-join-keeping-all-records-from-both-tables" class="nav-link" data-scroll-target="#full-outer-join-or-full-join-keeping-all-records-from-both-tables">FULL OUTER JOIN (or <code>FULL JOIN</code>): Keeping all records from both tables</a>
  <ul class="collapse">
  <li><a href="#full-overview-of-resident-and-intake-data" id="toc-full-overview-of-resident-and-intake-data" class="nav-link" data-scroll-target="#full-overview-of-resident-and-intake-data">Full overview of resident and intake data</a></li>
  </ul></li>
  <li><a href="#recap-visualizing-joins" id="toc-recap-visualizing-joins" class="nav-link" data-scroll-target="#recap-visualizing-joins">Recap: Visualizing joins</a></li>
  <li><a href="#joining-with-reference-tables" id="toc-joining-with-reference-tables" class="nav-link" data-scroll-target="#joining-with-reference-tables">Joining with reference tables</a>
  <ul class="collapse">
  <li><a href="#linking-intakes-to-county-names" id="toc-linking-intakes-to-county-names" class="nav-link" data-scroll-target="#linking-intakes-to-county-names">Linking intakes to county names</a></li>
  </ul></li>
  <li><a href="#chaining-multiple-joins" id="toc-chaining-multiple-joins" class="nav-link" data-scroll-target="#chaining-multiple-joins">Chaining multiple joins</a>
  <ul class="collapse">
  <li><a href="#joining-resident-demographics-intakes-and-facility-names" id="toc-joining-resident-demographics-intakes-and-facility-names" class="nav-link" data-scroll-target="#joining-resident-demographics-intakes-and-facility-names">Joining resident demographics, intakes, and facility names</a></li>
  </ul></li>
  <li><a href="#key-takeaways" id="toc-key-takeaways" class="nav-link" data-scroll-target="#key-takeaways">Key takeaways</a></li>
  <li><a href="#additional-resources" id="toc-additional-resources" class="nav-link" data-scroll-target="#additional-resources">Additional resources</a></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Lesson 4: Working with Multiple Tables</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>In previous lessons, we learned how to write basic SQL queries, filter and sort data, and perform aggregations. But most useful information in a corrections database doesn’t live in a single table. Resident characteristics may live in one table, intake dates in another, and facility details in yet another. To bring this information together tp glean meaningful insights, you’ll need to learn how to join tables.</p>
<p>In this lesson, you’ll learn how to do the following:</p>
<ul>
<li><p>Use different types of joins to combine data across tables.</p></li>
<li><p>Understand how primary keys and foreign keys connect tables.</p></li>
<li><p>Use table aliases to simplify your queries.</p></li>
</ul>
<p>Joins are essential for corrections analysts who need to pull together data from multiple sources—like linking resident demographics with intake histories, facility details, or education levels—to paint a more complete picture.</p>
</section>
<section id="understanding-table-relationships" class="level2">
<h2 class="anchored" data-anchor-id="understanding-table-relationships">Understanding table relationships</h2>
<p>In a relational database, tables are connected through <strong>key fields</strong> that define relationships between them. These keys are what allow us to combine and analyze data across multiple tables using joins.</p>
<p>There are two types of keys commonly involved in these relationships:</p>
<ul>
<li><p><strong>Primary Key (PK)</strong>: A unique identifier for each row in a table</p></li>
<li><p><strong>Foreign Key (FK)</strong>: A field that refers to the primary key in another table</p></li>
</ul>
<p>Let’s look at our Entity Relationship Diagram (ERD):</p>
<p><img src="images/corrections_erd.png" class="img-fluid"></p>
<p>Notice the following in the diagram:</p>
<ul>
<li><p>The <code>residents</code> table has a **primary *key** called <code>resident_id</code>.</p></li>
<li><p>The <code>intakes</code> table also includes a <code>resident_id</code>, but in this case, it’s a <strong>foreign key</strong> — it references the <code>resident_id</code> in the <code>residents</code> table. This connection lets you join the two tables to see both personal and intake information for each resident.</p></li>
<li><p>The <code>intakes</code> table also includes a <code>facil_id</code> (foreign key), which connects to the <code>facilities</code> table. This tells us which facility a resident was admitted to.</p></li>
<li><p>The <code>county_id</code> in intakes is a foreign key linking to the <code>counties</code> table, and the <code>ed_level_id</code> in residents links to the <code>ed_level</code> table.</p></li>
</ul>
<p>By identifying these primary–foreign key connections in the ERD, we can see how data is structured and how to join the right tables for analysis.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Understanding these relationships is key to writing accurate joins that return complete, meaningful data for analysis.</p>
</div>
</div>
</section>
<section id="types-of-joins-in-sql" class="level2">
<h2 class="anchored" data-anchor-id="types-of-joins-in-sql">Types of joins in SQL</h2>
<p>SQL supports several types of joins that define how rows from one table are matched with rows from another.</p>
<p>Before we look at the join types, it helps to understand what “left” and “right” mean:</p>
<ul>
<li><p>The <strong>left table</strong> is the one listed first in the <code>FROM</code> clause.</p></li>
<li><p>The <strong>right table</strong> is the one listed after the <code>JOIN</code> statement.</p></li>
</ul>
<p>You can think of SQL joins like combining two spreadsheets. The position of the tables (left or right) affects what data is returned, especially when rows don’t match between tables.</p>
<p>There are four main JOINS used in SQL:</p>
<ul>
<li><p><code>INNER JOIN</code>: Returns only the rows that have matching values in both tables</p></li>
<li><p><code>LEFT JOIN</code>: Returns all rows from the left table and matching rows from the right table</p></li>
<li><p><code>RIGHT JOIN</code>: Returns all rows from the right table and matching rows from the left table</p></li>
<li><p><code>FULL OUTER JOIN</code> (or <code>FULL JOIN</code>): Returns all rows from both tables, with <code>NULLs</code> where no match is found</p></li>
</ul>
<p><img src="images/joins_diagram.png" class="img-fluid"></p>
<p>Choosing the correct join depends on the kind of relationship you want to analyze and what type of completeness you need in your results.</p>
</section>
<section id="using-table-aliases" class="level2">
<h2 class="anchored" data-anchor-id="using-table-aliases">Using table aliases</h2>
<p>Before jumping into specific join types, let’s talk about table aliases. When you’re working with multiple tables, your queries can quickly get cluttered. Table aliases let you assign a short or easily interpretable nickname to a table—making your SQL easier to write and read.</p>
<p>Let’s look at an example of how to use table aliases.</p>
<p>Instead of using:</p>
<div class="interactive-sql">
<div class="sourceCode" id="cb1"><pre class="sourceCode sql interactive state_doc code-with-copy"><code class="sourceCode sql"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> residents.first_name, </span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>       residents.last_name, </span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>       intakes.admission_date</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> residents</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="kw">JOIN</span> intakes </span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>  <span class="kw">ON</span> residents.resident_id <span class="op">=</span> intakes.resident_id;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>You can use the following:</p>
<div class="interactive-sql">
<div class="sourceCode" id="cb2"><pre class="sourceCode sql interactive state_doc code-with-copy"><code class="sourceCode sql"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> r.first_name, </span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>       r.last_name, </span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>       i.admission_date</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> residents <span class="kw">AS</span> r</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="kw">JOIN</span> intakes <span class="kw">AS</span> i </span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>  <span class="kw">ON</span> r.resident_id <span class="op">=</span> i.resident_id;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In this example:</p>
<ul>
<li><p><code>r</code> is a shorthand for the residents table.</p></li>
<li><p><code>i</code> is a shorthand for the intakes table.</p></li>
</ul>
<p>This helps avoid repeating full table names, especially when the table names are long and/or complex or when there are multiple joins.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Be aware that organizations may have different style conventions regarding aliases. Some may prefer more descriptive or standardized aliasing to maintain readability. While short aliases save space, they can reduce clarity if it’s not immediately obvious which table each alias refers to.</p>
</div>
</div>
<p>Now let’s see what joins look like in practice.</p>
</section>
<section id="inner-join-matching-records-across-tables" class="level2">
<h2 class="anchored" data-anchor-id="inner-join-matching-records-across-tables">INNER JOIN: Matching records across tables</h2>
<p>An <code>INNER JOIN</code> returns records that exist in <strong>both</strong> tables based on a shared key. This is one of the most common types of joins you’ll use, as it gives you clean, reliable results by excluding any unmatched data. You’ll typically use an <code>INNER JOIN</code> when you’re only interested in records where the relationship exists in both tables—such as residents who have an intake record, or intakes that correspond to a known facility.</p>
<p>Let’s take a look:</p>
<section id="linking-resident-demographics-to-intakes-hh" class="level3">
<h3 class="anchored" data-anchor-id="linking-resident-demographics-to-intakes-hh">Linking resident demographics to intakes hh</h3>
<p>Suppose you want to view a list of residents and their admission dates. The resident names are stored in the <code>residents</code> table, and the admission dates are in the <code>intakes table</code>. Using an <code>INNER JOIN</code>, the following query can be used to view results with information from both tables:</p>
<div class="interactive-sql">
<div class="sourceCode" id="cb3"><pre class="sourceCode sql interactive state_doc code-with-copy"><code class="sourceCode sql"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> r.first_name, </span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>       r.last_name, </span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>       i.admission_date</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> residents <span class="kw">AS</span> r</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="kw">INNER</span> <span class="kw">JOIN</span> intakes <span class="kw">AS</span> i</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>      <span class="kw">ON</span> r.resident_id <span class="op">=</span> i.resident_id;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>or</p>
<div class="interactive-sql">
<div class="sourceCode" id="cb4"><pre class="sourceCode sql interactive state_doc code-with-copy"><code class="sourceCode sql"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> r.first_name, </span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>       r.last_name, </span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>       i.admission_date</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> residents <span class="kw">AS</span> r</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="kw">JOIN</span> intakes <span class="kw">AS</span> i</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>  <span class="kw">ON</span> r.resident_id <span class="op">=</span> i.resident_id;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>What these queries do:</strong></p>
<p>Both queries pull only records that exist in both residents and intakes. It retrieves the first and last names of residents from the <code>residents</code> table and the admission date from the <code>intakes</code> table. It could be useful for printing a roster or other type of report.</p>
<p><img src="images/inner_join.png" class="img-fluid"></p>
</section>
</section>
<section id="left-join-keeping-all-records-from-the-first-left-table" class="level2">
<h2 class="anchored" data-anchor-id="left-join-keeping-all-records-from-the-first-left-table">LEFT JOIN: Keeping all records from the first (left) table</h2>
<p>A <code>LEFT JOIN</code> returns all records from the <strong>left table</strong> (the table listed in the <code>FROM</code> clause) and any matching records from the <strong>right table</strong> (the table listed in the <code>LEFT JOIN</code> clause). If there’s no match, you’ll still see the row from the left table, but the columns from the right table will show <code>NULL</code> or blank. You can use a <code>LEFT JOIN</code> when you want to keep all data from your main table—even if there’s no related information in the joined table. For example, if you want a list of all intakes, even if some are missing a linked resident, a <code>LEFT JOIN</code> ensures they aren’t excluded from your results.</p>
<section id="joining-intakes-with-resident-data" class="level3">
<h3 class="anchored" data-anchor-id="joining-intakes-with-resident-data">Joining intakes with resident data</h3>
<p>You’ve been asked to help the research team prepare a report on recent admissions into the state correctional system. The report should include details about each admission, including the resident’s id, admission date, offense group, sex, and birth country.</p>
<div class="interactive-sql">
<div class="sourceCode" id="cb5"><pre class="sourceCode sql interactive state_doc code-with-copy"><code class="sourceCode sql"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> i.resident_id, </span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>       i.admission_date, </span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>       i.off_group,</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>       r.sex, </span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>       r.birth_country </span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> intakes <span class="kw">AS</span> i</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="kw">LEFT</span> <span class="kw">JOIN</span> residents <span class="kw">AS</span> r</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>  <span class="kw">ON</span> i.resident_id <span class="op">=</span> r.resident_id;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>What this query does:</strong></p>
<p>This query returns a list of all admissions from the intakes table, even if there is no matching resident information in the residents table. This is useful for identifying admissions that may be missing all or partial resident records. Notice in the example that the <code>resident_id = doc_0003</code> birth country is blank. In this case the resident has a record, but it is incomplete.</p>
<p><img src="images/left_join.png" class="img-fluid"></p>
</section>
</section>
<section id="right-join-keeping-all-records-from-the-second-right-table" class="level2">
<h2 class="anchored" data-anchor-id="right-join-keeping-all-records-from-the-second-right-table">RIGHT JOIN: Keeping all records from the second (right) table</h2>
<p>A <code>RIGHT JOIN</code> works just like a <code>LEFT JOIN</code>, except it returns all records from the right table, and only matching records from the left table.</p>
<section id="viewing-all-intakes-even-without-matching-resident-info" class="level3">
<h3 class="anchored" data-anchor-id="viewing-all-intakes-even-without-matching-resident-info">Viewing all intakes (even without matching resident info)</h3>
<p>Let’s say your intake system is collecting records independently, and some intakes might not have matched residents yet due to pending ID verification. The following query can be used:</p>
<div class="interactive-sql">
<div class="sourceCode" id="cb6"><pre class="sourceCode sql interactive state_doc code-with-copy"><code class="sourceCode sql"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> r.resident_id, </span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>       r.first_name, </span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>       i.intake_id, </span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>       i.admission_date</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> residents <span class="kw">AS</span> r</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="kw">RIGHT</span> <span class="kw">JOIN</span> intakes <span class="kw">AS</span> i</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>  <span class="kw">ON</span> r.resident_id <span class="op">=</span> i.resident_id;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>What this query does:</strong></p>
<p>This would return all intakes, even those that don’t have matching residents. This is useful when checking for unmatched or abandoned records in your system. In our database, all of our intake records are matched to residents, so no nulls were returned.</p>
<p><img src="images/right_join.png" class="img-fluid"></p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>A <code>RIGHT JOIN</code> is less common, as it’s just a flipped version of a <code>LEFT JOIN</code>. Most people prefer <code>LEFT JOIN</code> since it’s more natural to list the main table first. You can avoid a <code>RIGHT JOIN</code> by switching the table order and using a <code>LEFT JOIN</code> so that it’s easier to read and more consistent.</p>
</div>
</div>
</section>
</section>
<section id="full-outer-join-or-full-join-keeping-all-records-from-both-tables" class="level2">
<h2 class="anchored" data-anchor-id="full-outer-join-or-full-join-keeping-all-records-from-both-tables">FULL OUTER JOIN (or <code>FULL JOIN</code>): Keeping all records from both tables</h2>
<p>A <code>FULL OUTER JOIN</code> returns every record from both tables, whether or not they match. Where there is no match, you’ll see <code>NULLs</code>. This type of join is useful when you need a complete view of two datasets—even when some records don’t align. For example, if you’re comparing two systems to find mismatched data (e.g., a list of facilities from two different databases), a full outer join can help identify entries that only exist in one source or the other.</p>
<section id="full-overview-of-resident-and-intake-data" class="level3">
<h3 class="anchored" data-anchor-id="full-overview-of-resident-and-intake-data">Full overview of resident and intake data</h3>
<div class="interactive-sql">
<div class="sourceCode" id="cb7"><pre class="sourceCode sql interactive state_doc code-with-copy"><code class="sourceCode sql"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> r.resident_id, </span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>       r.first_name, </span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>       i.intake_id, </span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>       i.admission_date</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> residents <span class="kw">AS</span> r</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="kw">FULL</span> <span class="kw">OUTER</span> <span class="kw">JOIN</span> intakes <span class="kw">AS</span> i</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>  <span class="kw">ON</span> r.resident_id <span class="op">=</span> i.resident_id;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>What this query does:</strong></p>
<p>This returns everything—residents without intakes, intakes without residents, and all matched pairs. In our database, all of our intake records are matched to residents, so no nulls were returned.</p>
<p><img src="images/outer_join.png" class="img-fluid"></p>
</section>
</section>
<section id="recap-visualizing-joins" class="level2">
<h2 class="anchored" data-anchor-id="recap-visualizing-joins">Recap: Visualizing joins</h2>
<p>Let’s look at a quick comparison of the different <strong>join types</strong> using the <code>intakes</code> and <code>residents</code> tables as examples. Here’s a visual guide showing the different types of joins and what data is returned from each:</p>
<p><img src="images/join_example.png" class="img-fluid"></p>
</section>
<section id="joining-with-reference-tables" class="level2">
<h2 class="anchored" data-anchor-id="joining-with-reference-tables">Joining with reference tables</h2>
<p>You’ll often need to join to reference tables to pull in descriptive labels—like the full name of a county or facility. These tables store standardized data that appears repeatedly across records. Instead of storing long text descriptions in every row of a large table (like <code>intakes</code>), databases use compact codes (like <code>county_id</code>) to link to these reference tables. This keeps the database efficient, consistent, and easier to maintain. Reference tables are also useful for updating standard terms in one place without needing to modify multiple tables.</p>
<section id="linking-intakes-to-county-names" class="level3">
<h3 class="anchored" data-anchor-id="linking-intakes-to-county-names">Linking intakes to county names</h3>
<p>Let’s say your report needs to show county names rather than numeric IDs. You can join your query to the county reference table:</p>
<div class="interactive-sql">
<div class="sourceCode" id="cb8"><pre class="sourceCode sql interactive state_doc code-with-copy"><code class="sourceCode sql"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> i.intake_id, </span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>       i.admission_date, </span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>       c.county_name</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> intakes <span class="kw">AS</span> i</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="kw">LEFT</span> <span class="kw">JOIN</span> counties <span class="kw">AS</span> c </span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>  <span class="kw">ON</span> i.county_id <span class="op">=</span> c.county_id;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>What this query does:</strong> It joins the <code>intakes</code> table with the <code>counties</code> reference table using <code>county_id</code> and replaces the ID with a more digestible county name.</p>
<p><img src="images/ref_join.png" class="img-fluid"></p>
<p>In a corrections environment, this helps communicate data findings more clearly—especially when sharing dashboards or reports with stakeholders who may not recognize internal ID numbers.</p>
</section>
</section>
<section id="chaining-multiple-joins" class="level2">
<h2 class="anchored" data-anchor-id="chaining-multiple-joins">Chaining multiple joins</h2>
<p>You can also join multiple tables in a single query to build a more complete dataset.</p>
<p>Let’s give it a try!</p>
<section id="joining-resident-demographics-intakes-and-facility-names" class="level3">
<h3 class="anchored" data-anchor-id="joining-resident-demographics-intakes-and-facility-names">Joining resident demographics, intakes, and facility names</h3>
<p>Let’s say you’re running a report to review resident profiles and need to include their admission date and the facility they’re housed in. The following query can be used to <code>JOIN</code> the <code>residents</code> table to the <code>intakes</code> and <code>facilities</code> tables.</p>
<div class="interactive-sql">
<div class="sourceCode" id="cb9"><pre class="sourceCode sql interactive state_doc code-with-copy"><code class="sourceCode sql"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> r.first_name, </span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>       r.last_name, </span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>       i.admission_date, </span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>       f.facil_name</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> residents <span class="kw">AS</span> r</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="kw">INNER</span> <span class="kw">JOIN</span> intakes <span class="kw">AS</span> i </span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>  <span class="kw">ON</span> r.resident_id <span class="op">=</span> i.resident_id</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="kw">INNER</span> <span class="kw">JOIN</span> facilities <span class="kw">AS</span> f </span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>  <span class="kw">ON</span> i.facil_id <span class="op">=</span> f.facil_id;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>What this query does:</strong></p>
<p>It combines three tables to show which residents were admitted to which facilities and when.</p>
<p><img src="images/chain_join.png" class="img-fluid"></p>
</section>
</section>
<section id="key-takeaways" class="level2">
<h2 class="anchored" data-anchor-id="key-takeaways">Key takeaways</h2>
<ul>
<li><p>Joins are essential for combining related information spread across multiple tables in a relational database.</p></li>
<li><p>SQL supports different types of joins:</p>
<ul>
<li><p><code>INNER JOIN</code>: includes only rows with matching values in both tables</p></li>
<li><p><code>LEFT JOIN</code>: includes all rows from the left table and matching rows from the right</p></li>
<li><p><code>RIGHT JOIN</code>: includes all rows from the right table and matching rows from the left</p></li>
<li><p><code>FULL OUTER JOIN</code>: includes unmatched rows from either or both tables</p></li>
</ul></li>
<li><p>Table aliases make your queries cleaner, easier to read, and potentially shorter. This is especially helpful when joining multiple tables.</p></li>
<li><p>Understanding how tables relate to one another using primary and foreign keys is necessary for writing accurate join conditions.</p></li>
<li><p>You can join reference tables (like facilities, counties, or ed_levels) to enrich your results with descriptive information instead of numeric IDs.</p></li>
<li><p>SQL allows you to chain multiple joins, combining three or more tables to pull together complex insights—for example, linking a resident to their intake and the facility they’re housed in.</p></li>
</ul>
<p>These skills are essential for making connections between datasets and uncovering meaningful insights in corrections data. Real-world data analysis often requires looking beyond a single table. Knowing how to join across tables gives you the power to see the full picture, spot gaps, and generate meaningful insights that support operations, audits, and decision-making in corrections.</p>
<hr>
<p>In this lesson, you learned how to join tables to combine information from multiple sources—a critical skill for working with relational databases. You practiced different types of joins, including <code>INNER</code>, <code>LEFT</code>, <code>RIGHT</code>, and <code>FULL OUTER</code>, and saw how each one can be used to build a more complete picture of your data. In the next lesson, you’ll explore how to create calculated fields and use built-in SQL functions to perform on-the-fly analysis, helping you answer key questions and identify patterns in corrections data.</p>
</section>
<section id="additional-resources" class="level2">
<h2 class="anchored" data-anchor-id="additional-resources">Additional resources</h2>
<ul>
<li><a href="https://www.w3schools.com/sql/sql_join.asp">SQLJoins</a></li>
</ul>
<sqlime-db name="state_doc" path="https://raw.githubusercontent.com/CSGJusticeCenter/va_data/main/courses/intro_sql/state_doc.db"></sqlime-db>
<sqlime-examples db="state_doc" selector="div.interactive-sql pre.state_doc code" editable=""></sqlime-examples>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
            // target, if specified
            link.setAttribute("target", "_blank");
            if (link.getAttribute("rel") === null) {
              link.setAttribute("rel", "noopener");
            }
            // default icon
            link.classList.add("external");
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




<script src="../libs/quarto-contrib/interactive-sql-1.0.0/interactive-sql.js"></script>
</body></html>