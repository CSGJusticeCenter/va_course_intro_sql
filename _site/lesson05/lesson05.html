<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Lesson 5: Applying SQL to Corrections Data</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../libs/clipboard/clipboard.min.js"></script>
<script src="../libs/quarto-html/quarto.js" type="module"></script>
<script src="../libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../libs/quarto-html/popper.min.js"></script>
<script src="../libs/quarto-html/tippy.umd.min.js"></script>
<script src="../libs/quarto-html/anchor.min.js"></script>
<link href="../libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../libs/bootstrap/bootstrap.min.js"></script>
<link href="../libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../libs/bootstrap/bootstrap-8de619bbd21ce238746bc3d87e490689.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<link href="../libs/quarto-contrib/interactive-sql-1.0.0/interactive-sql.css" rel="stylesheet">
<link rel="preconnect" href="https://fonts.googleapis.com">

<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="">

<link href="https://fonts.googleapis.com/css2?family=Public+Sans:ital,wght@0,100..900;1,100..900&amp;display=swap" rel="stylesheet">
<script src="https://unpkg.com/@antonz/sqlite@3.40.0/dist/sqlite3.js"></script>
<script src="https://unpkg.com/sqlime@0.1.3/dist/sqlime-db.js"></script>
<script src="https://unpkg.com/sqlime@0.1.3/dist/sqlime-examples.js"></script>


</head>

<body class="quarto-light">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#using-arithmetic-in-sql" id="toc-using-arithmetic-in-sql" class="nav-link" data-scroll-target="#using-arithmetic-in-sql">Using arithmetic in SQL</a>
  <ul class="collapse">
  <li><a href="#estimate-total-sentence-length-in-months" id="toc-estimate-total-sentence-length-in-months" class="nav-link" data-scroll-target="#estimate-total-sentence-length-in-months">Estimate total sentence length in months</a></li>
  </ul></li>
  <li><a href="#using-built-in-functions" id="toc-using-built-in-functions" class="nav-link" data-scroll-target="#using-built-in-functions">Using built-in functions</a>
  <ul class="collapse">
  <li><a href="#standardized-reporting" id="toc-standardized-reporting" class="nav-link" data-scroll-target="#standardized-reporting">Standardized reporting</a></li>
  </ul></li>
  <li><a href="#working-with-date-expressions" id="toc-working-with-date-expressions" class="nav-link" data-scroll-target="#working-with-date-expressions">Working with date expressions</a>
  <ul class="collapse">
  <li><a href="#calculate-days-in-custody" id="toc-calculate-days-in-custody" class="nav-link" data-scroll-target="#calculate-days-in-custody">Calculate days in custody</a></li>
  <li><a href="#time-between-sentence-date-and-admission-date" id="toc-time-between-sentence-date-and-admission-date" class="nav-link" data-scroll-target="#time-between-sentence-date-and-admission-date">Time between sentence date and admission date</a></li>
  </ul></li>
  <li><a href="#formatting-and-commenting-your-queries" id="toc-formatting-and-commenting-your-queries" class="nav-link" data-scroll-target="#formatting-and-commenting-your-queries">Formatting and commenting your queries</a>
  <ul class="collapse">
  <li><a href="#formatting-tips" id="toc-formatting-tips" class="nav-link" data-scroll-target="#formatting-tips">Formatting tips:</a></li>
  <li><a href="#commenting-tips" id="toc-commenting-tips" class="nav-link" data-scroll-target="#commenting-tips">Commenting tips:</a></li>
  </ul></li>
  <li><a href="#query-writing-best-practices" id="toc-query-writing-best-practices" class="nav-link" data-scroll-target="#query-writing-best-practices">Query writing best practices</a></li>
  <li><a href="#answering-real-world-corrections-questions" id="toc-answering-real-world-corrections-questions" class="nav-link" data-scroll-target="#answering-real-world-corrections-questions">Answering real-world corrections questions</a>
  <ul class="collapse">
  <li><a href="#average-sentence-length-by-facility" id="toc-average-sentence-length-by-facility" class="nav-link" data-scroll-target="#average-sentence-length-by-facility">Average sentence length by facility</a></li>
  </ul></li>
  <li><a href="#key-takeaways" id="toc-key-takeaways" class="nav-link" data-scroll-target="#key-takeaways">Key takeaways</a></li>
  <li><a href="#additional-resources" id="toc-additional-resources" class="nav-link" data-scroll-target="#additional-resources">Additional resources</a></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Lesson 5: Applying SQL to Corrections Data</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>In previous lessons, you learned how to write basic SQL queries and use filtering, grouping, and joins to analyze your corrections data. In this final lesson, you’ll build on those skills by learning how to use SQL to answer real-world corrections questions. You’ll explore how to perform calculations directly in your queries; work with date expressions; apply built-in SQL functions; and follow best practices for clean, readable code.</p>
<p>These skills help corrections analysts calculate sentence lengths, monitor release readiness, identify trends in admissions or discharges, and perform quality control on key data points.</p>
<p>By the end of this lesson, you’ll be able to do the following:</p>
<ul>
<li><p>Use arithmetic in SQL queries.</p></li>
<li><p>Work with date expressions using SQLite’s <code>JULIANDAY()</code> function.</p></li>
<li><p>Use built-in SQL functions like <code>ROUND()</code> and <code>UPPER()</code>.</p></li>
<li><p>Format and comment your SQL queries.</p></li>
<li><p>Answer practical corrections questions using your SQL skills.</p></li>
</ul>
</section>
<section id="using-arithmetic-in-sql" class="level2">
<h2 class="anchored" data-anchor-id="using-arithmetic-in-sql">Using arithmetic in SQL</h2>
<p>Arithmetic operations are helpful when you need to calculate totals or differences from multiple numeric columns. In corrections data, this often means calculating the total length of a sentence, estimating release windows, or comparing numeric metrics like beds available vs.&nbsp;residents housed.</p>
<p>Basic Arithmetic Operators:</p>
<ul>
<li><p><code>+</code> addition</p></li>
<li><p><code>-</code> subtraction</p></li>
<li><p><code>*</code> multiplication</p></li>
<li><p><code>/</code> division</p></li>
</ul>
<section id="estimate-total-sentence-length-in-months" class="level3">
<h3 class="anchored" data-anchor-id="estimate-total-sentence-length-in-months">Estimate total sentence length in months</h3>
<p>Let’s say you’re building a dashboard metric for sentence length trends. Your data includes sentence years and months in separate columns, but you want the results in a single column. You can query a report to total the <code>sentence_years</code> and <code>sentence_months</code> together.</p>
<div class="interactive-sql">
<div class="sourceCode" id="cb1"><pre class="sourceCode sql interactive state_doc code-with-copy"><code class="sourceCode sql"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> resident_id,</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>       sentence_years <span class="op">*</span> <span class="dv">12</span> <span class="op">+</span> sentence_months <span class="kw">AS</span> total_sentence_months</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> intakes;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>What this query does:</strong></p>
<ul>
<li><p>Converts <code>sentence_years</code> into months by multiplying by 12 then adds <code>sentence_months</code> for a full sentence length in months.</p></li>
<li><p>Puts the result of this calculation in a new field, <code>total_sentence_months</code>, assigning it a clear and intuitive name so it’s readable in your output.</p></li>
</ul>
<p>This kind of calculation helps analysts report average sentence lengths consistently, even when year/month data is stored separately.</p>
</section>
</section>
<section id="using-built-in-functions" class="level2">
<h2 class="anchored" data-anchor-id="using-built-in-functions">Using built-in functions</h2>
<p>Built-in functions are predefined tools in SQL that help you transform and clean your data. They make queries more flexible and readable, and they let you format outputs for reports and dashboards.</p>
<p>These functions are particularly useful when doing the following:</p>
<ul>
<li><p>Cleaning or standardizing raw data</p></li>
<li><p>Summarizing or rounding data (e.g., sentence averages)</p></li>
<li><p>Standardizing formatting (e.g., make county names uppercase)</p></li>
<li><p>Performing real-time calculations (e.g., using the current date)</p></li>
<li><p>Preparing reports or dashboards for external stakeholders</p></li>
</ul>
<p>Here are some useful built-in functions you can use in SQLite:</p>
<ul>
<li><p><code>ROUND()</code>: Rounds numeric values to a given decimal place</p></li>
<li><p><code>UPPER()</code>: Converts text to uppercase</p></li>
<li><p><code>JULIANDAY()</code>: Returns the number of days since January 1, 4173 BC</p></li>
</ul>
<section id="standardized-reporting" class="level3">
<h3 class="anchored" data-anchor-id="standardized-reporting">Standardized reporting</h3>
<p>Let’s say you need to prepare a list of residents whose last names must be standardized for reporting and round their sentence lengths to the nearest whole number of years. The following query can be used:</p>
<div class="interactive-sql">
<div class="sourceCode" id="cb2"><pre class="sourceCode sql interactive state_doc code-with-copy"><code class="sourceCode sql"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> i.resident_id,</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>       <span class="fu">UPPER</span>(r.last_name) <span class="kw">AS</span> standardized_last_name,</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>       <span class="fu">ROUND</span>(i.sentence_years, <span class="dv">0</span>) <span class="kw">AS</span> rounded_sentence_years,</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>       JULIANDAY(exp_release_date) <span class="op">-</span> JULIANDAY(sentence_date) <span class="kw">AS</span> Sent_To_Exp_Release</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> intakes <span class="kw">AS</span> i</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="kw">JOIN</span> residents <span class="kw">AS</span> r <span class="kw">ON</span> i.resident_id <span class="op">=</span> r.resident_id;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>What this query does:</strong></p>
<ul>
<li><p>Converts each resident’s last name to all uppercase for consistency.</p></li>
<li><p>Rounds their sentence to the nearest whole year.</p></li>
<li><p><code>JULIANDAY()</code> converts both dates into numeric values, calculates the difference, returning the number of days between when a resident was sentenced and is expected to be released.</p></li>
<li><p>Pulls this info from both the intakes and residents tables using a join.</p></li>
</ul>
</section>
</section>
<section id="working-with-date-expressions" class="level2">
<h2 class="anchored" data-anchor-id="working-with-date-expressions">Working with date expressions</h2>
<p>Many important corrections metrics depend on understanding the time between two events—like time from admission to release, or sentence date to release readiness. To calculate those time intervals, SQL provides helpful date functions.</p>
<p>SQL offers a variety of date and time functions to manipulate and extract values like day, month, year, or the number of days between two events. While the specific syntax may vary between different versions of SQL (e.g., SQLite, MySQL, SQL Server), the core functionality remains consistent.</p>
<p>Because this course uses SQLite, we’ll rely on the <code>JULIANDAY()</code> function for date calculations. In other SQL environments (like SQL Server or PostgreSQL), the exact function name might differ, but the logic stays largely the same.</p>
<p>For example, a function like <code>DATEDIFF()</code> is commonly used in other SQL engines to calculate the difference between two dates:</p>
<div class="interactive-sql">
<div class="sourceCode" id="cb3"><pre class="sourceCode sql interactive state_doc code-with-copy"><code class="sourceCode sql"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>DATEDIFF(<span class="dt">day</span>, start_date, end_date)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Calculating days between dates with <code>JULIANDAY()</code></strong></p>
<p>SQLite doesn’t have a built-in <code>DATEDIFF()</code> function. Instead, you would calculate the difference between two dates using <code>JULIANDAY()</code> like this:</p>
<div class="interactive-sql">
<div class="sourceCode" id="cb4"><pre class="sourceCode sql interactive state_doc code-with-copy"><code class="sourceCode sql"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>JULIANDAY(end_date) <span class="op">-</span> JULIANDAY(start_date)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s put it into practice.</p>
<section id="calculate-days-in-custody" class="level3">
<h3 class="anchored" data-anchor-id="calculate-days-in-custody">Calculate days in custody</h3>
<p>Suppose you want to calculate how long each resident has been in custody. This query can be used to calculate the day difference from their admission date to today:</p>
<div class="interactive-sql">
<div class="sourceCode" id="cb5"><pre class="sourceCode sql interactive state_doc code-with-copy"><code class="sourceCode sql"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> resident_id,</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>       admission_date,</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>       JULIANDAY(<span class="st">'now'</span>) <span class="op">-</span> JULIANDAY(admission_date) <span class="kw">AS</span> days_incarcerated</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> intakes;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>What this query does:</strong></p>
<ul>
<li><p>‘now’ is SQLite’s shortcut for the current date and time.</p></li>
<li><p><code>JULIANDAY()</code> converts both dates into numeric values.</p></li>
<li><p>Subtracting them gives you the number of days each person has been in custody.</p></li>
</ul>
</section>
<section id="time-between-sentence-date-and-admission-date" class="level3">
<h3 class="anchored" data-anchor-id="time-between-sentence-date-and-admission-date">Time between sentence date and admission date</h3>
<p>Quarterly audits are due and you’ve been tasked with generating a report to audit the number of days it takes a person to be admitted into custody after being sentenced. You can use the following query:</p>
<div class="interactive-sql">
<div class="sourceCode" id="cb6"><pre class="sourceCode sql interactive state_doc code-with-copy"><code class="sourceCode sql"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> resident_id,</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>       sentence_date,</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>       admission_date,</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>       JULIANDAY(admission_date) <span class="op">-</span> JULIANDAY(sentence_date) <span class="kw">AS</span> days_to_admit</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> intakes;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>What this query does:</strong></p>
<ul>
<li><p><code>JULIANDAY()</code> converts <code>admission_date</code> and <code>sentence_date</code> into numeric values.</p></li>
<li><p>Calculates the difference in days, giving you the number of days from sentencing to admission for each resident.</p></li>
<li><p>The result of the calculation is put in a new field called <code>days_to_admit</code>.</p></li>
</ul>
</section>
</section>
<section id="formatting-and-commenting-your-queries" class="level2">
<h2 class="anchored" data-anchor-id="formatting-and-commenting-your-queries">Formatting and commenting your queries</h2>
<p>Readable queries are maintainable queries—especially when working in teams or across departments! Here are some tips to keep your queries clean and professional:</p>
<section id="formatting-tips" class="level3">
<h3 class="anchored" data-anchor-id="formatting-tips">Formatting tips:</h3>
<ul>
<li><p>Use <strong>indentation</strong> and <strong>line breaks</strong>.</p>
<ul>
<li><p>Place each <code>SELECT</code> field on its own line.</p></li>
<li><p>Put <code>JOIN</code> and <code>WHERE</code> clauses on new lines.</p></li>
</ul></li>
<li><p>Use <strong>consistent spacing</strong> for readability.</p></li>
<li><p>Use <strong>descriptive aliases</strong> for your tables (with longer names) to make joins easier to follow.</p></li>
</ul>
</section>
<section id="commenting-tips" class="level3">
<h3 class="anchored" data-anchor-id="commenting-tips">Commenting tips:</h3>
<p>Comments are helpful for leaving notes or explanations for both you and your team. You can explain why a query exists, explain what each part is doing, or temporarily disable parts of a query.</p>
<ul>
<li>Use <code>--</code> for single-line comments:</li>
</ul>
<div class="interactive-sql">
<div class="sourceCode" id="cb7"><pre class="sourceCode sql interactive state_doc code-with-copy"><code class="sourceCode sql"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- This query retrieves the result for residents with sentences longer than 5 years</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> resident_id</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> intakes</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="kw">WHERE</span> sentence_years <span class="op">&gt;</span> <span class="dv">5</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>Use /* */ for multi-line comments:</li>
</ul>
<div class="interactive-sql">
<div class="sourceCode" id="cb8"><pre class="sourceCode sql interactive state_doc code-with-copy"><code class="sourceCode sql"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co">/* This query calculates the total sentence length in months</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="co">   by converting years to months and adding remaining months */</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> resident_id,</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>       sentence_years <span class="op">*</span> <span class="dv">12</span> <span class="op">+</span> sentence_months <span class="kw">AS</span> total_sentence_months</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> intakes;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>When you’re writing or testing SQL queries, you may want to temporarily turn off or “disable” part of the query without deleting it. This is useful if you’re troubleshooting, testing, or building your query step by step. You can do this using either of the commenting commands:</p>
<div class="interactive-sql">
<div class="sourceCode" id="cb9"><pre class="sourceCode sql interactive state_doc code-with-copy"><code class="sourceCode sql"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> first_name, </span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>       last_name,</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>       <span class="co">-- birth_country (-- Temporarily disables this field selction)</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> residents</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="co">/* </span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="co">WHERE birth_country = 'Mexico'</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="co">AND age_at_first_arrest &lt; 18</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="co">(This filter has been temporarily disabled)</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a><span class="co">*/</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>These techniques help you experiment with your queries or debug issues without losing your work. Once you’re ready to use that part of the query again, just remove the comment symbols.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<strong>Naming table aliases</strong>
</div>
</div>
<div class="callout-body-container callout-body">
<p>When you alias tables, aim for clarity. Descriptive aliases (like <code>res</code> for residents or <code>intk</code> for intakes) help everyone understand your query at a glance—especially when sharing with colleagues who might not know your database schema.</p>
<p>That said, you’ll often encounter production queries that use very short aliases (sometimes a single letter, like r, i, or f) to save typing and reduce screen clutter. In those cases, make sure you—and anyone reading your code—know what each alias stands for. A simple comment at the top can help:</p>
<div class="interactive-sql">
<div class="sourceCode" id="cb10"><pre class="sourceCode sql interactive state_doc code-with-copy"><code class="sourceCode sql"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- r = residents, i = intakes, f = facilities</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> r.resident_id, </span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>       i.admission_date, </span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>       f.facil_name</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> residents <span class="kw">AS</span> r</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="kw">JOIN</span> intakes <span class="kw">AS</span> i  </span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>  <span class="kw">ON</span> r.resident_id <span class="op">=</span> i.resident_id</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a><span class="kw">JOIN</span> facilities <span class="kw">AS</span> f <span class="kw">ON</span> i.facil_id    <span class="op">=</span> f.facil_id;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Balance readability with brevity: choose meaningful aliases when possible, but don’t be surprised to see, and use, short ones in mature codebases.</p>
</div>
</div>
</section>
</section>
<section id="query-writing-best-practices" class="level2">
<h2 class="anchored" data-anchor-id="query-writing-best-practices">Query writing best practices</h2>
<p>As you wrap up your learning, keep these best practices in mind:</p>
<ul>
<li><p><strong>Avoid using <code>SELECT *</code> </strong> in production queries; always specify needed columns. This improves performance, reduces memory usage, and makes your queries easier to understand and maintain. When your query only includes necessary fields, you also <strong>reduce the risk of exposing sensitive or unnecessary data</strong>.</p></li>
<li><p>Use <strong>descriptive aliases</strong> for clarity, making your output easier to interpret, especially when working with aggregate or derived values.</p></li>
<li><p><strong>Test queries with small filters</strong> before applying them broadly.</p></li>
<li><p><strong>Comment complex logic</strong> for future reference. Comments are particularly useful when your query will be reused or reviewed by others.</p></li>
<li><p>Use consistent indentation and line breaks: This improves readability and helps others (and your future self!) understand your logic at a glance.</p></li>
<li><p>Use functions like <code>ROUND()</code> to <strong>clean up results before sharing</strong>.</p></li>
</ul>
<p>Clean, readable queries are easier to debug, maintain, and reuse—especially when collaborating across teams or building dashboards.</p>
</section>
<section id="answering-real-world-corrections-questions" class="level2">
<h2 class="anchored" data-anchor-id="answering-real-world-corrections-questions">Answering real-world corrections questions</h2>
<p>Now that you’ve built a solid foundation in querying, filtering, joining, and summarizing data, you’re ready to apply these skills to answer real-world questions. In corrections work, SQL is an essential tool that helps analysts and decision-makers uncover insights, track outcomes, and monitor progress across facilities, programs, and populations.</p>
<p>Corrections analysts are often asked questions like:</p>
<ul>
<li><p>How many residents were admitted to each facility last month?</p></li>
<li><p>What is the average sentence length by offense group?</p></li>
<li><p>Which counties send the most residents into the system?</p></li>
</ul>
<p>These are not just hypothetical queries—they’re common, high-value questions used in everything from administrative reporting and strategic planning to improving operational efficiency. As an analyst, your ability to quickly and accurately generate answers to these types of questions helps your agency make data-informed decisions.</p>
<p>Let’s take a look at one more real-world example applying some of our best practices!</p>
<hr>
<section id="average-sentence-length-by-facility" class="level3">
<h3 class="anchored" data-anchor-id="average-sentence-length-by-facility">Average sentence length by facility</h3>
<p>Facility directors want to understand how long, on average, residents are sentenced to serve at each location so they can plan programming, staffing levels, and health services accordingly. You’re tasked with generating a report that shows the average sentence length (in months) for all residents by facility. Your supervisor also asks you to include comments explaining the code you use to generate the report.</p>
<div class="interactive-sql">
<div class="sourceCode" id="cb11"><pre class="sourceCode sql interactive state_doc code-with-copy"><code class="sourceCode sql"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co">/*</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="co">This query joins the intakes table to the facilities table on facil_id, converts sentence_years and sentence_months into total months, calculates the average sentence length in months using AVG(), rounds the result to one decimal place with ROUND(), and groups the output by facility name so you see one average per facility.</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="co">*/</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> f.facil_name,</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>       <span class="fu">ROUND</span>(<span class="fu">AVG</span>(i.sentence_years <span class="op">*</span> <span class="dv">12</span> <span class="op">+</span> i.sentence_months), <span class="dv">1</span>) <span class="kw">AS</span> avg_sentence_months</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> intakes <span class="kw">AS</span> i</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="kw">JOIN</span> facilities <span class="kw">AS</span> f </span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>  <span class="kw">ON</span> i.facil_id <span class="op">=</span> f.facil_id</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a><span class="kw">GROUP</span> <span class="kw">BY</span> f.facil_name;</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Notice that there is a <strong>comment section provided at the top of the query</strong> explaining what the query does. This is a key best practice—it helps anyone reading the code understand your logic without needing to reverse-engineer the query. The query also demonstrates <strong>good aliasing</strong> by using short, readable aliases (<code>i</code> and <code>f</code>), <strong>rounds the result</strong> for presentation clarity, and uses a <strong>descriptive alias</strong> (<code>avg_sentence_months</code>) to label the output column clearly.</p>
</section>
</section>
<section id="key-takeaways" class="level2">
<h2 class="anchored" data-anchor-id="key-takeaways">Key takeaways</h2>
<ul>
<li><p>You can perform arithmetic in SQL to calculate sentence lengths, durations, and more.</p></li>
<li><p>Aliases make your results easier to interpret and your queries easier to read.</p></li>
<li><p>Date expressions are powerful tools for analyzing incarceration durations, pending cases, and release trends.</p></li>
<li><p><code>JULIANDAY()</code> is a powerful SQLite function to calculate date differences.</p></li>
<li><p>Built-in functions enhance the precision and clarity of your data outputs.</p></li>
<li><p>By combining joins, filters, calculations, and functions, you can answer a wide range of corrections-related questions.</p></li>
<li><p>Always format and comment your queries for readability and future edits.</p></li>
<li><p>Following best practices helps ensure your queries are maintainable, accurate, and professional.</p></li>
</ul>
<hr>
<p>Congratulations 🎉! You’ve reached the end of the course. You now have a solid foundation in SQL for corrections analytics. From here, you can explore more advanced SQL topics like subqueries, window functions, or data validation techniques—or begin applying what you’ve learned directly to real data and dashboards.</p>
</section>
<section id="additional-resources" class="level2">
<h2 class="anchored" data-anchor-id="additional-resources">Additional resources</h2>
<ul>
<li>W3Schools.com (Website with more in-depth SQL learning and practice)</li>
<li>MySQL Cookbook, Fourth Edition</li>
</ul>
<sqlime-db name="state_doc" path="https://raw.githubusercontent.com/CSGJusticeCenter/va_data/main/courses/intro_sql/state_doc.db"></sqlime-db>
<sqlime-examples db="state_doc" selector="div.interactive-sql pre.state_doc code" editable=""></sqlime-examples>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
            // target, if specified
            link.setAttribute("target", "_blank");
            if (link.getAttribute("rel") === null) {
              link.setAttribute("rel", "noopener");
            }
            // default icon
            link.classList.add("external");
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




<script src="../libs/quarto-contrib/interactive-sql-1.0.0/interactive-sql.js"></script>
</body></html>