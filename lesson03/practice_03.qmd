---
title: "Lesson 3 Exercise"
engine: knitr
filters:
  - interactive-sql
databases:
  - name: state_doc
    path: "https://raw.githubusercontent.com/CSGJusticeCenter/va_data/main/courses/intro_sql/state_doc.db"  
---

![](images/corrections_erd.png)

1. A researcher is analyzing sentence trends across offense categories. Write a query that returns the average sentence length (in months) by offense group. Include the offense group name and the number of residents in each group. Round the average sentence length to one decimal place. You can refer to the ERD above to review table structure and column names.

```{.sql .interactive .state_doc}

```

<details>
<summary>Show the answer</summary>

```{.sql .interactive .state_doc}
SELECT off_group,
       COUNT(i.resident_id) AS resident_count,
       ROUND(AVG(sentence_years * 12 + sentence_months), 1) AS avg_sentence_months
FROM intakes AS i
GROUP BY off_group;
```
</details>

2. Department leadership is working to reduce housing costs across all facilities and wants to identify facilities housing fewer than 100 residents. Write a query that retrieves each facilityâ€™s name and the number of residents housed there. Only include facilities with fewer than 250 residents. You can refer to the ERD above to review table structure and column names.

```{.sql .interactive .state_doc}

```

<details>
<summary>Show the answer</summary>
```{.sql .interactive .state_doc}
SELECT facil_id, COUNT(*) AS total_residents
FROM intakes
GROUP BY facil_id
HAVING COUNT(*) < 250;
```
</details>